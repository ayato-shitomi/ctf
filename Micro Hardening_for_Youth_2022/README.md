# 概要

今日は「Micro Hardening」というCTFの逆を体験してきました。  
ECサイトへ来る様々な攻撃シュツエーションに対してUnixの知識などを用いて防衛をしました。  
今日学んだことの記録をDiscordに書いていたので、共有をします。  
これからプロダクトをリリースするにあたり、有事の際に何をするべきなのかを体験的に学べました！  
（事故が起こらないのが一番いいんですけどね）  
https://sc4y.connpass.com/event/257374/

# 学んだこと

## セキュリティインシデントに対応するときに大切なこと
- 作業プロセスの記録
- 作業内容の共有
- 元に戻すことができる準備
- サービス稼働状況の調査
- 不審ログに関する調査
仲間に共有にしても作業を元に戻すにしても、作業プロセスを記録するとすごく楽！
複数ユーザーや複数Shellで作業するにあたって、いちいちhistoryで実行コマンドを確認する時間はない！

## 技術力を増やすことがなぜ大切か
技術的な手持ちの札を増やすといい。
実務でインシデントが発生した際には制約があるはず。
Ex）このサービスは通信にこんな脆弱性があるが、停止はできない→「FWを使おう」

## 競技の振り返り
ユーザーパスワードポリシーを一律で変更するべきだった
CronTab等で元のHTMLファイルの改ざん検知をするべきだった
Webサーバーにほかの機能（メールなど）がインストールされてる場合、そちらにも注意するべき。
SeLinuxを有効化するだけでほとんどの攻撃をブロックできた。

## 事故が起こりやすいとき
・情報がない、情報共有がない
　特に情報共有がされてないと複数人でインフラとバックエンドを開発するときに事故が起こりやすい！
・緊急な対応をした
　緊急対応には事故がつきもの。情報整理を徹底するべき。

##よりセキュアな環境を作る意識
あくまで一例だが、MTGは顔出しを必須にするといい。
実際に事故対応の際に、攻撃者がSlackのMTGに入っていたことがあったらしい。

# 作ったスクリプト

バックドアが作られているか調べる`chkrootkit`が用意されていた為それを常時叩いていた。
Bashスクリプトの重要性がわかった。

```bash
while :
do
    clear
    date
    echo "===="
    sudo /usr/sbin/chkrootkit | grep "INF"
    echo -n "==== " && sudo cat /var/log/sudolog | wc -l
    sudo tail -n 10 /var/log/sudolog
    echo "===="
    sleep 5
done
```

# 有効だった対策

SeLinuxを動かしたらほとんどの攻撃に対して防御できた。
